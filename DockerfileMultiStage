FROM maven:3 as BUILD_IMAGE
ENV APP_HOME=/root/dev/my-app/
#RUN mkdir -p /root/dev/myapp/
#WORKDIR /myapp
#RUN groupadd --gid 1000 appuser && \
   # useradd --uid 1000 --gid 1000 --shell /bin/bash --create-home appuser
#RUN chown -R appuser:appuser /myapp
#USER appuser

WORKDIR $APP_HOME
COPY . .
RUN mvn -B package -e -X --file myapp/pom.xml

FROM openjdk:8-jre
WORKDIR /root/
COPY --from=BUILD_IMAGE /root/dev/my-app/myapp/target/myapp*.jar .
CMD java -jar myapp*.jar 



FROM openjdk:8-jdk-alpine
COPY myapp/target/*.jar /app/app.jar
WORKDIR /app
ENV JAR_FILE=app.jar
RUN adduser -D myuser
USER myuser
#CMD ["java", "-jar", "${JAR_FILE}"]
CMD java -jar ${JAR_FILE} && tail -f /dev/null


--build-arg POM=${{steps.bump.outputs.jar_version}}

#- name:  Save jar artifact
      #uses: actions/upload-artifact@v2
      #with:
        #name: jar-artifact
        #path: ${{ github.workspace }}/myapp/target/*.jar
        #retention-days: 1
        
        
        
 #OLD_VERSION=$(grep -m1 "<version>" $POMPATH/pom.xml | sed -E 's|<version>(.*)</version>|\1|g' | tr -d '[:space:]')

